let l=parseInt(localStorage.getItem("vista_indice"));if(localStorage.getItem("indicesViews")){let t=localStorage.getItem("indicesViews"),e=JSON.parse(t),n=e[3];console.log(n.id),console.log(n.vista_guardada);let a=e.find(c=>c.id===l),i=n.id,o=n.vista_guardada===1;i!=l&&o&&u(a.variable_ruta),i!=l&&!o&&u(a.variable_ruta)}else alert("No se ha creado ningun curso, se te redirecionara al panel de control!!"),window.location.href=route("home");function u(t){window.location.href=route(t)}let O=localStorage.getItem("dataObjetivos"),j=JSON.parse(O),w=localStorage.getItem("curso_id"),g=JSON.parse(w);const r=document.getElementById("myForm"),d=document.getElementById("selectObjetivoParticular"),v=document.getElementById("dataobjetivo"),p=document.getElementById("dataaccion"),f=document.getElementById("datacondicion"),b=document.getElementById("objetivos_id"),y=document.getElementById("curso_id"),I=document.getElementById("cantidadTemas"),B=document.getElementById("divTemas"),N=document.getElementById("cantidadTemas");N.addEventListener("input",function(){this.value<1&&(this.value=1),this.value>15&&(this.value=15)});r.style.display="none";const h=t=>{const e=route("seccion3b-getDataObj",{idCurso:t});fetch(e).then(n=>n.json()).then(n=>{console.log(n),x(n.data)}).catch(n=>console.error("Error:",n))};h(parseInt(g));const x=t=>{m("Escoja un Objetivo"),t.length>0?t.map(e=>{let n=document.createElement("option");n.text=e.descripcion,n.value=e.id,d.add(n),console.log("Este es el largo del array",t.length)}):(m("No hay datos disponibles ve a la siguiente secciÃ³n"),q())},m=t=>{d.innerHTML="";let e=document.createElement("option");e.text=t,e.value=0,d.add(e)};d.addEventListener("change",function(){let t=Number(this.value);if(t!==0){r.style.display="block";let e=J(t);v.innerText=e.sujeto,p.innerText=e.accion,f.innerText=e.condicion,b.value=e.id,y.value=e.cursos_id,I.value=""}else r.style.display="none",E()});const J=t=>j.find(e=>e.id===t);I.addEventListener("input",()=>{const t=event.target.value;D(t)});const D=t=>{let e="";for(let n=0;n<t;n++)e+=`
        <div class="mb-3">
        <div class="name ">Tema ${n+1}</div>
            <div class="input-group wrap-input100 validate-input" >
                <input id="tema[${n}]" class="form-control" type="text" name="tema[${n}]" autocomplete="Tema" autocomplete="off" required>
                <span class="focus-input100 "></span>
        <span class="symbol-input100">
            <i class="fa fa-envelope"></i>
        </span>
            </div>
        </div>
        `;B.innerHTML=e};r.addEventListener("submit",t=>{t.preventDefault();const e=route("seccion3b-store"),n=document.getElementById("cantidadTemas").value,a=V(t,n),i=L(a);fetch(e,i).then(s=>s.json()).then(C).catch(s=>console.error("Error:",s));let o=localStorage.getItem("indicesViews"),c=JSON.parse(o);c[3].vista_guardada=0,console.log(c),localStorage.setItem("indicesViews",JSON.stringify(c));let S=localStorage.getItem("curso_id"),T=c[3].nombre_vista_actual,_=route("actualizar-seguimiento",{nombreVista:T,CursoId:S});fetch(_).then(s=>s.json()).then(s=>{console.log(s)})});const V=(t,e)=>{const n=new FormData(t.target),a=Object.fromEntries(n.entries());a.temas=[],a.idCurso=parseInt(y.value);for(let i=0;i<e;i++){const o={};o.tema=document.getElementById(`tema[${i}]`).value,o.objetivos_id=b.value,a.temas.push(o)}return a},L=t=>({method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(t)}),C=()=>{h(parseInt(g)),E()},E=()=>{r.style.display="none",document.getElementById("divTemas").innerHTML="",document.getElementById("cantidadTemas").value="",v.innerText="",p.innerText="",f.innerText=""};function q(){let t=localStorage.getItem("indicesViews"),e=JSON.parse(t),n=localStorage.getItem("curso_id"),a=e[3].nombre_vista_actual,i=route("seguimiento3b",{nombreVista:a,CursoId:n});fetch(i).then(o=>o.json()).then(o=>{console.log(o),o.alcanzado&&(e[3].vista_guardada=1,console.log(e),localStorage.setItem("indicesViews",JSON.stringify(e)),l++,localStorage.setItem("vista_indice",JSON.stringify(l)),window.location.href=route("seccion3c-create"))})}
