let c=parseInt(localStorage.getItem("vista_indice"));if(localStorage.getItem("indicesViews")){let e=localStorage.getItem("indicesViews"),t=JSON.parse(e),i=t[6];console.log(i.id),console.log(i.vista_guardada);let r=t.find(f=>f.id===c),n=i.id,s=i.vista_guardada===1;n!=c&&s&&q(r.variable_ruta),n!=c&&!s&&q(r.variable_ruta)}else alert("No se ha creado ningun curso, se te redirecionara al panel de control!!"),window.location.href=route("home");function q(e){window.location.href=route(e)}let b=localStorage.getItem("dataObjetivos"),w=[{id:1,descripcion:"Requerimientos en instalaciones, mobiliario y su distribuci칩n"},{id:2,descripcion:"Requerimientos en equipo de apoyo y su distribuci칩n"},{id:3,descripcion:"Requerimientos en materiales did치cticos de apoyo"},{id:4,descripcion:"Requerimientos humanos"},{id:5,descripcion:"Otros (Todo el material extra que no se pueda incluir en las columnas anteriores)"},{id:6,descripcion:"Material y equipo para las medidas de: salud/seguridad/higiene/ protecci칩n civil"}],S=JSON.parse(b),a;localStorage.getItem("copiaGetDataRequerimientos")?a=JSON.parse(localStorage.getItem("copiaGetDataRequerimientos")):(a=[...w],localStorage.setItem("copiaGetDataRequerimientos",JSON.stringify(a)));let p=0;console.log(p);console.log(a);let d=document.getElementById("selectRequerimiento"),u=0,I=document.getElementById("requerimientos_id"),v=document.getElementById("myForm");v.style.display="none";a.map(e=>{let t=document.createElement("option");t.text=e.descripcion,t.value=e.id,d.add(t)});S?S.forEach(function(e){p=e.cursos_id,console.log(p)}):console.log("El array no existe en el Local Storage");d.onchange=function(){let e=Number(this.value);e!==0?v.style.display="block":v.style.display="none",u=a.find(t=>t.id===e),I.value=u.id,console.log("El objeto seleccionado es: ",u)};document.getElementById("cantidadRequerimientos").addEventListener("input",()=>{let e="";const t=event.target.value;for(let i=0;i<t;i++)e+=`
        <div class="mb-3">
        <div class="name">Requerimiento </div>
            <div class="input-group wrap-input100 validate-input" >
                <input id="requerimiento[${i}]" class="form-control" type="text" name="requerimiento[${i}]" autocomplete="Requerimiento" required>
                <span class="focus-input100 "></span>
        <span class="symbol-input100">
            <i class="fa fa-envelope"></i>
        </span>
            </div>
        </div>
        `;document.getElementById("divRequerimientos").innerHTML=e});document.getElementById("myForm").addEventListener("submit",e=>{e.preventDefault();const t=route("seccion4-store"),i=document.getElementById("cantidadRequerimientos").value,r=new FormData(e.target),n=Object.fromEntries(r.entries());n.requerimientos=[];for(let o=0;o<i;o++){const l={};l.requerimiento=document.getElementById(`requerimiento[${o}]`).value,l.requerimientos_id=I.value,l.cursos_id=p,n.requerimientos.push(l)}console.log(n);const s={method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(n)};fetch(t,s).then(o=>o.json()).then(o=>{console.log(o),v.style.display="none",document.getElementById("divRequerimientos").innerHTML="",console.log("indice para eliminar "+u),a=a.filter(g=>g.id!=u.id),localStorage.setItem("copiaGetDataRequerimientos",JSON.stringify(a)),location.reload(),console.log("Despues de el for each",a),d.innerHTML="";let l=document.createElement("option");l.text="Escoja un Requerimiento",l.value=0,d.add(l),a.map(g=>{let y=document.createElement("option");y.text=g.descripcion,y.value=g.id,d.add(y)})});let f=localStorage.getItem("indicesViews"),m=JSON.parse(f);m[6].vista_guardada=0,console.log(m),localStorage.setItem("indicesViews",JSON.stringify(m));let _=localStorage.getItem("curso_id"),h=m[6].nombre_vista_actual,R=route("actualizar-seguimiento",{nombreVista:h,CursoId:_});fetch(R).then(o=>o.json()).then(o=>{console.log(o)}),E()});function E(){let e=localStorage.getItem("indicesViews"),t=JSON.parse(e),i=localStorage.getItem("curso_id"),r=t[6].nombre_vista_actual,n=route("seguimiento4",{nombreVista:r,CursoId:i});fetch(n).then(s=>s.json()).then(s=>{console.log(s),s.alcanzado&&(t[6].vista_guardada=1,console.log(t),localStorage.setItem("indicesViews",JSON.stringify(t)),c++,localStorage.setItem("vista_indice",JSON.stringify(c)),localStorage.removeItem("copiaGetDataRequerimientos"),window.location.href=route("seccion5-create"))})}
