let l=parseInt(localStorage.getItem("vista_indice"));if(localStorage.getItem("indicesViews")){let e=localStorage.getItem("indicesViews"),a=JSON.parse(e),t=a[4];console.log(t.id),console.log(t.vista_guardada);let n=a.find(u=>u.id===l),o=t.id,i=t.vista_guardada===1;o!=l&&i&&v(n.variable_ruta),o!=l&&!i&&v(n.variable_ruta)}else alert("No se ha creado ningun curso, se te redirecionara al panel de control!!"),window.location.href=route("home");function v(e){window.location.href=route(e)}const w=localStorage.getItem("dataObjetivos"),p=JSON.parse(w),S=document.getElementById("selectObjetivoParticular3c"),c=document.getElementById("selectTemas"),O=document.getElementById("cantidadSubtemas"),g=document.getElementById("FormSubtemas");document.getElementById("curso_id");g.style.display="none";let m,f=0,b=0;O.addEventListener("input",function(){this.value<1&&(this.value=1),this.value>15&&(this.value=15)});const d=(e,a)=>{let t=document.createElement("option");return t.text=e,t.value=a,t};p.map(e=>S.add(d(e.descripcion,e.id)));S.onchange=function(){let e=Number(this.value);b=p.find(n=>n.id===e).cursos_id;let t=route("seccion3c-getTemas",{IdObjetivo:e,CursoId:b});fetch(t).then(n=>n.json()).then(n=>{console.log(n),m=n.data,y(),m.length===0?c.add(d("No hay temas, si no encuentra mas temas al escoger objetivos, pase a la siguiente secciÃ³n",0)):(c.add(d("Escoja un Tema",0)),m.map(o=>c.add(d(o.tema,o.id))))})};c.onchange=function(){let e=Number(this.value);g.style.display=e!==0?"block":"none",f=e};document.getElementById("cantidadSubtemas").addEventListener("input",()=>{let e="";const a=event.target.value;for(let t=0;t<a;t++)e+=`<div class="mb-3"><div class="name ">Subtema ${t+1}</div><div class="input-group wrap-input100 validate-input" ><input id="subtema[${t}]" class="form-control" type="text" name="subtema[${t}]" autocomplete="Subtema" required><span class="focus-input100 "></span><span class="symbol-input100"><i class="fa fa-envelope"></i></span></div></div>`;document.getElementById("divSubtemas").innerHTML=e});document.getElementById("FormSubtemas").addEventListener("submit",e=>{e.preventDefault();const a=route("seccion3c-store"),t=document.getElementById("cantidadSubtemas").value,n=new FormData(e.target),o=Object.fromEntries(n.entries());o.subtemas=Array.from({length:t},(s,_)=>({subtema:document.getElementById(`subtema[${_}]`).value,id:f}));const i={method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(o)};fetch(a,i).then(s=>s.json()).then(s=>{console.log(s),y(),c.add(d("Escoja un objetivo",0))});let u=localStorage.getItem("indicesViews"),r=JSON.parse(u);r[4].vista_guardada=0,console.log(r),localStorage.setItem("indicesViews",JSON.stringify(r));let h=localStorage.getItem("curso_id"),I=r[4].nombre_vista_actual,E=route("actualizar-seguimiento",{nombreVista:I,CursoId:h});fetch(E).then(s=>s.json()).then(s=>{console.log(s)}),j()});const y=()=>{g.style.display="none",document.getElementById("divSubtemas").innerHTML="",document.getElementById("cantidadSubtemas").value="",c.innerHTML=""};function j(){let e=localStorage.getItem("indicesViews"),a=JSON.parse(e),t=localStorage.getItem("curso_id"),n=a[4].nombre_vista_actual,o=route("seguimiento3c",{nombreVista:n,CursoId:t});fetch(o).then(i=>i.json()).then(i=>{console.log(i),i.alcanzado&&(a[4].vista_guardada=1,console.log(a),localStorage.setItem("indicesViews",JSON.stringify(a)),l++,localStorage.setItem("vista_indice",JSON.stringify(l)),window.location.href=route("seccion3d-create"))})}
